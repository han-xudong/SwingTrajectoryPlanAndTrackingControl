# SwingTrajectoryPlanAndTrackingControl

In this project, we focus on the planning and control for the swing trajectories.

The codes are based on: <https://xbpeng.github.io/projects/Robotic_Imitation/index.html>

## Getting Started

We use this repository with Python 3.7 or Python 3.8 on Ubuntu, MacOS and Windows.

- Install MPC extension (Optional) `python3 setup.py install --user`

Install dependencies:

- Install MPI: `sudo apt install libopenmpi-dev`
- Install requirements: `pip3 install -r requirements.txt`

You can run `mpc_controller/my_swing_example.py` to get a quickstart.

Here are the definitions of the varibles:
`_RECORD_VIDEO`: `True` or `False` to record a video of the simulation process or not, which requires ffmpeg in the path.
`_MAX_TIME_SECONDS`: the maximum running time (seconds) of the simulatioin process.
`_NUM_BULLET_SOLVER_ITERATIONS`: 
`_SIMULATION_TIME_STEP`: 
`_ROBOT_BASE_HEIGHT`: 
`_WITH_OBSTACLE`: 
`_OBSTACLE_HALF_SIZE`: 
`_OBSTACLE_POS`: 
`_MAX_CLEARANCE`: 
`_PHASE_NUM`: 
`_WITH_OPTIMIZATION`: 
`_FOOT_STEP_DISP`: 
`_PARAMETERS`: 
`_SAVE_PATH`: 

## Finding a feasible trajectory connecting the initial and final positions

We give a method to find a feasible swing trajectory when given an initial and final position of the foot tip. And we also design a tracking controller to track the planned trajectory. To simplify, we only consider the single FR leg.

In `mpc_controller/my_swing_example.py`, the initial position of the foot is (0, 0, 0), and the final position is based on `_FOOT_STEP_DISP` which is a 4x3 matrix describing all 4 foot displacements. We can change `_FOOT_STEP_DISP` to give different swing path.

## Finding a collision-free trajectory when there are known obstacles

In the presence of known obstacles, a swing trajectory can also be generated by the proposed method with a collision avoidence module. We tested the trajectory generating method with obtacles of different height of 0.02, 0.04, 0.06, and 0.08 mm. All the tests were successful, which means that the method is avalible.

In `mpc_controller/my_swing_example.py`, to show an obstacle, `_WITH_OBSTACLE` need to be `True`. `_OBSTACLE_HALF_SIZE` and `_OBSTACLE_POS` define the size and position of the obstacle.
